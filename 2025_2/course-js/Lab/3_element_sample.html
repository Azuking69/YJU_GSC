<!-- 
과제!
- 1단계: 코드 이해 (주석 작성: JS를 이용하여 HTML element 조정 방법 확인)
- 2단계: “동일 기능”을 다른 구조로 재작성
- 3단계: 기능 1개 “자유 확장” 
-->

<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>DOM CRUD Practice</title>
  </head>
  <body>
    <h2>DOM CRUD (Add / Delete / Edit)</h2>
    <!-- 입력 박스(문자로 인식) -->
    <input id="txt" type="text" placeholder="할 일을 입력" />
    <!-- 추가 버튼 -->
    <button id="btnAdd">추가</button>
    <!-- 리스트 작성 -->
    <ul id="list"></ul>

    <script>
      // 입력 내용 가져오기
      const txt = document.getElementById("txt");
      const btnAdd = document.getElementById("btnAdd");
      const list = document.getElementById("list");

      // createItem 메소드 만들기
      function createItem(text) {
        // 내용 만들기
        const li = document.createElement("li");

        const span = document.createElement("span");
        span.textContent = text;
        //
        const input = document.createElement("input");
        input.type = "text";
        input.value = text;
        input.style.display = "none";
        // 수정 버튼 만들기
        const btnEdit = document.createElement("button");
        btnEdit.textContent = "수정";
        // 저장 버튼 만들기
        const btnSave = document.createElement("button");
        btnSave.textContent = "저장";
        btnSave.style.display = "none";
        // 취소 버튼 만들기
        const btnCancel = document.createElement("button");
        btnCancel.textContent = "취소";
        btnCancel.style.display = "none";
        // 삭제 버튼 만들기
        const btnDel = document.createElement("button");
        btnDel.textContent = "삭제";
        // prevText 변수에 text를 넣기
        let prevText = text;

        // enterEditMode inner 함수 만들기
        function enterEditMode() {
          prevText = span.textContent;
          input.value = prevText;

          span.style.display = "none";
          input.style.display = "";

          btnEdit.style.display = "none";
          btnSave.style.display = "";
          btnCancel.style.display = "";

          btnDel.disabled = true;

          input.focus();
          input.select();
        }

        // exitEditMode inner 함수 만들기
        function exitEditMode() {
          span.style.display = "";
          input.style.display = "none";

          btnEdit.style.display = "";
          btnSave.style.display = "none";
          btnCancel.style.display = "none";

          btnDel.disabled = false;
        }
        // click하면 enterEditMode에
        btnEdit.addEventListener("click", enterEditMode);

        btnSave.addEventListener("click", () => {
          const value = input.value.trim();
          if (!value) return;
          span.textContent = value;
          exitEditMode();
        });

        btnCancel.addEventListener("click", () => {
          span.textContent = prevText;
          exitEditMode();
        });
        // click하면 remove에
        btnDel.addEventListener("click", () => li.remove());

        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") btnSave.click();
          if (e.key === "Escape") btnCancel.click();
        });

        li.appendChild(span);
        li.appendChild(input);
        li.appendChild(document.createTextNode(" "));
        li.appendChild(btnEdit);
        li.appendChild(btnSave);
        li.appendChild(btnCancel);
        li.appendChild(btnDel);

        return li;
      }

      btnAdd.addEventListener("click", () => {
        const value = txt.value.trim();
        if (!value) return;

        list.appendChild(createItem(value));

        txt.value = "";
        txt.focus();
      });

      txt.addEventListener("keydown", (e) => {
        if (e.key === "Enter") btnAdd.click();
      });
    </script>
  </body>
</html>
